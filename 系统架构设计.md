# 学生成绩查询系统架构设计

## 1. 系统概述

本系统是一个基于Web的学生成绩查询系统，支持教师录入成绩、学生查询成绩，并具备时间段控制功能。系统采用前后端分离架构，使用Spring Boot + React技术栈，集成Redis缓存和腾讯云服务。

## 2. 技术栈

### 前端技术栈
- **框架**: React 18.3.1 + TypeScript
- **UI组件库**: Ant Design 5.19.4
- **路由管理**: React Router v6.26.2
- **HTTP客户端**: Axios 1.7.7
- **状态管理**: React Hooks + localStorage
- **构建工具**: Vite
- **开发语言**: TypeScript

### 后端技术栈
- **框架**: Spring Boot 3.5.6 + Java 21
- **安全框架**: 自定义JWT实现
- **数据访问**: MyBatis 3.0.3
- **Web框架**: Spring Web (RESTful API)
- **文件处理**: Apache POI (Excel解析)
- **缓存**: Redis (腾讯云Redis)
- **数据库**: MySQL 8.0 (腾讯云MySQL)
- **构建工具**: Maven
- **文档**: Springdoc OpenAPI 3

### 腾讯云服务
- **数据库**: 腾讯云MySQL (43.139.178.197:13306)
- **缓存**: 腾讯云Redis (43.139.178.197:26739)
- **文件存储**: 本地文件系统
- **监控**: 腾讯云监控

## 3. 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        用户层                                │
├─────────────────┬─────────────────┬─────────────────────────┤
│   学生用户      │   教师用户      │     管理员用户           │
└─────────────────┴─────────────────┴─────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                      前端层 (React + Vite)                   │
├─────────────────────────────────────────────────────────────┤
│  • 学生成绩查询界面    • 教师成绩录入界面    • 管理员界面      │
│  • 个人信息管理界面    • 我的课程界面        • 时间段管理界面  │
│  • 课程学生查询界面    • 批量导入界面        • 用户管理界面    │
└─────────────────────────────────────────────────────────────┘
                            │ HTTP/HTTPS
┌─────────────────────────────────────────────────────────────┐
│                    API网关层 (Spring Boot)                   │
├─────────────────────────────────────────────────────────────┤
│  • 身份认证 (JWT)      • 权限控制 (@RoleRequired)          │
│  • 数据验证            • 异常处理          • 日志记录         │
│  • 限流控制 (@RateLimit) • 缓存控制 (@Cacheable)           │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                    业务逻辑层 (Spring Boot)                  │
├─────────────────────────────────────────────────────────────┤
│  • StudentService      • TeacherService    • GradeService   │
│  • CourseService       • TimePeriodService  • CacheService   │
│  • BatchImportService  • CourseTimePeriodService            │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                     数据访问层 (MyBatis)                     │
├─────────────────────────────────────────────────────────────┤
│  • StudentMapper       • TeacherMapper      • GradeMapper    │
│  • CourseMapper        • TimePeriodMapper   • UserMapper     │
│  • TeacherCourseMapper • CourseTimePeriodMapper             │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                     数据存储层 (腾讯云)                       │
├─────────────────────────────────────────────────────────────┤
│  • 腾讯云MySQL         • 腾讯云Redis                       │
│  • 本地文件存储         • 腾讯云监控                         │
└─────────────────────────────────────────────────────────────┘
```

## 4. 核心功能模块

### 4.1 学生功能模块
- **成绩查询**: 查看个人成绩，支持按学期、学年筛选
- **个人信息管理**: 查看和修改个人基本信息
- **时间段控制**: 只能在指定时间段内查询成绩

### 4.2 教师功能模块
- **成绩录入**: 单个成绩录入和批量导入
- **成绩管理**: 修改、删除成绩记录
- **我的课程**: 查看教授的课程列表
- **课程学生查询**: 查看课程的所有学生及其成绩
- **时间段设置**: 设置成绩查询开放时间段
- **文件上传**: 支持Excel/CSV文件批量导入

### 4.3 管理员功能模块
- **学生信息管理**: 增删改查学生信息
- **教师信息管理**: 增删改查教师信息
- **课程信息管理**: 增删改查课程信息
- **时间段管理**: 设置成绩查询开放时间段
- **系统监控**: 缓存管理和限流测试

## 5. 数据库设计

### 逻辑外键与一致性策略
- 不创建数据库物理外键；由服务层校验跨表存在性与删除保护
- 定时一致性审计与修复脚本保障长期数据健康
- 索引策略覆盖"外键字段"，用于查询与约束但不施加物理FK

### 5.1 核心实体
- **用户表 (users)**: 存储所有用户信息
- **学生表 (students)**: 存储学生详细信息
- **教师表 (teachers)**: 存储教师详细信息
- **课程表 (courses)**: 存储课程信息
- **成绩表 (grades)**: 存储成绩记录
- **时间段表 (time_periods)**: 存储查询时间段设置
- **教师课程关联表 (teacher_courses)**: 存储教师与课程的关联关系
- **课程时间段表 (course_time_periods)**: 存储课程级别的时间段控制

### 5.2 关系设计
- 用户与学生：一对一关系
- 用户与教师：一对一关系
- 学生与成绩：一对多关系
- 教师与成绩：一对多关系
- 课程与成绩：一对多关系
- 教师与课程：多对多关系（通过teacher_courses表）
- 时间段与成绩查询：一对多关系
- 课程与时间段：多对多关系（通过course_time_periods表）

## 6. API设计

### 6.1 认证相关API
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出

### 6.2 学生相关API
- `GET /api/students/profile` - 获取个人信息
- `PUT /api/students/profile` - 更新个人信息
- `GET /api/grades/student/{studentId}` - 按学生ID查询成绩
- `GET /api/grades/student/by-number/{studentNumber}` - 按学号查询成绩

### 6.3 教师相关API
- `GET /api/courses/my-courses` - 获取我的课程
- `GET /api/courses/{courseId}/students` - 获取课程学生
- `POST /api/grades` - 录入成绩
- `PUT /api/grades/{id}` - 修改成绩
- `GET /api/grades/teacher/student/{studentNumber}` - 教师查询学生成绩
- `POST /api/files/grades/import` - 批量导入成绩
- `GET /api/files/grades/template` - 下载导入模板

### 6.4 管理员相关API
- `GET /api/students` - 获取学生列表
- `POST /api/students` - 添加学生
- `PUT /api/students/{id}` - 修改学生信息
- `DELETE /api/students/{id}` - 删除学生
- `GET /api/teachers` - 获取教师列表
- `POST /api/teachers` - 添加教师
- `PUT /api/teachers/{id}` - 修改教师信息
- `DELETE /api/teachers/{id}` - 删除教师
- `GET /api/courses` - 获取课程列表
- `POST /api/courses` - 添加课程
- `PUT /api/courses/{id}` - 修改课程信息
- `DELETE /api/courses/{id}` - 删除课程
- `GET /api/time-periods` - 获取时间段列表
- `POST /api/time-periods` - 添加时间段
- `PUT /api/time-periods/{id}` - 修改时间段
- `DELETE /api/time-periods/{id}` - 删除时间段

### 6.5 系统管理API
- `GET /api/test/cache` - 测试缓存功能
- `GET /api/test/rate-limit` - 测试限流功能
- `POST /api/test/clear-all-cache` - 清除所有缓存
- `GET /api/test/cache-status` - 检查缓存状态

## 7. 安全设计

### 7.1 身份认证
- JWT Token认证（自定义实现）
- Token过期机制（86400000分钟）
- 基于角色的访问控制 (RBAC)

### 7.2 权限控制
- `@RoleRequired` 注解控制API访问权限
- 前端路由权限控制
- 学生只能查询自己的成绩
- 教师只能查询自己课程的学生成绩

### 7.3 数据安全
- HTTPS传输加密
- 密码加密存储
- SQL注入防护（MyBatis参数化查询）
- XSS攻击防护

## 8. 性能优化

### 8.1 前端优化
- Vite构建工具，快速热重载
- Ant Design组件库，优化渲染性能
- React Hooks状态管理，减少不必要的重渲染

### 8.2 后端优化
- Redis缓存策略（@Cacheable注解）
- 接口限流控制（@RateLimit注解）
- 数据库索引优化
- MyBatis查询优化
- 连接池配置

### 8.3 缓存策略
- 学生成绩查询缓存（10分钟）
- 课程信息缓存
- 时间段信息缓存
- Redis缓存自动过期机制

## 9. 部署架构

### 9.1 开发环境
- 前端：Vite开发服务器 (localhost:5174)
- 后端：Spring Boot内嵌Tomcat (localhost:8080)
- 数据库：腾讯云MySQL
- 缓存：腾讯云Redis

### 9.2 生产环境
- 前端：Vite构建静态文件
- 后端：Spring Boot JAR包部署
- 数据库：腾讯云MySQL
- 缓存：腾讯云Redis

## 10. 监控和日志

### 10.1 监控
- Spring Boot Actuator健康检查
- 腾讯云监控
- 缓存状态监控
- 限流状态监控

### 10.2 日志
- Spring Boot默认日志配置
- MyBatis SQL日志
- 业务异常日志
- 操作审计日志

## 11. 特色功能

### 11.1 时间段控制
- 全局时间段控制
- 课程级别时间段控制
- 时间段开放状态检查

### 11.2 批量导入
- Excel文件解析（Apache POI）
- CSV文件解析
- 数据验证和错误处理
- 导入模板下载

### 11.3 缓存和限流
- Redis缓存集成
- 接口限流控制
- 缓存清理机制
- 性能监控

## 12. 技术亮点

### 12.1 自定义JWT实现
- 完全自主实现的JWT认证系统
- 角色权限控制
- Token刷新机制

### 12.2 逻辑外键设计
- 不使用数据库物理外键
- 服务层数据一致性校验
- 灵活的数据库设计

### 12.3 缓存和限流
- 注解式缓存控制
- 注解式限流控制
- Redis集成优化

### 12.4 文件处理
- 多格式文件支持
- 文件类型检测
- 批量数据处理